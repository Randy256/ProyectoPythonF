{% extends 'baseadmin.html' %} {% block title %} LISTA DE PRODUCTOS {% endblock
%} {% block body %}

<!-- SweetAlert2 para mensajes flash -->
{% with messages = get_flashed_messages(with_categories=true) %} {% if
messages%}
<ul class="flashes">
  {% for category, message in messages %}
  <script type="text/javascript">
    const Toast = Swal.mixin({
      toast: true,
      position: "top-end",
      showConfirmButton: false,
      timer: 2000,
      timerProgressBar: true,
      didOpen: (toast) => {
        toast.onmouseenter = Swal.stopTimer;
        toast.onmouseleave = Swal.resumeTimer;
      },
    });
    Toast.fire({
      icon: "success",
      title: "{{ message }}",
    });
  </script>
  {% endfor %}
</ul>
{% endif %} {% endwith %}

<script>
  function confirmarEliminacion(url) {
    Swal.fire({
      title: "¬øEst√°s seguro?",
      text: "¬°No podr√°s revertir esto!",
      icon: "warning",
      showCancelButton: true,
      confirmButtonColor: "#d33",
      cancelButtonColor: "#3085d6",
      confirmButtonText: "S√≠, eliminar",
      cancelButtonText: "Cancelar",
    }).then((result) => {
      if (result.isConfirmed) {
        window.location.href = url;
      }
    });
  }
</script>

<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-md-10">
      <div class="card shadow-sm">
        <div class="card-header bg-danger bg-opacity-25 text-center">
          <h2 class="mb-0">
            Lista de Productos (Total: {{ productos | length }})
          </h2>
        </div>
        <div class="card-body bg-success bg-opacity-10">
          <table
            id="tablaProductos"
            class="table table-striped table-bordered table-hover"
            style="width: 100%"
          >
            <thead class="table-dark">
              <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Marca</th>
                <th>Precio</th>
                <th>Cantidad</th>
                <th>Fecha de Registro</th>
                <th>Fecha de Caducidad</th>
                <th>Descripci√≥n</th>
                <th>Acciones</th>
              </tr>
            </thead>
            <tbody>
              {% for producto in productos %}
              <tr>
                <td>{{ producto.id }}</td>
                <td>{{ producto.nombre }}</td>
                <td>{{ producto.marca }}</td>
                <td>{{ producto.precio }}</td>
                <td>{{ producto.cantidad }}</td>
                <td>{{ producto.registro }}</td>
                <td>
                  {{ producto.caducidad if producto.caducidad else "Producto sin
                  caducidad" }}
                </td>
                <td>{{ producto.descripcion }}</td>
                <td>
                  <a
                    href="{{ url_for('editar_producto', id=producto.id) }}"
                    data-bs-toggle="tooltip"
                    data-bs-placement="top"
                    title="Editar producto..."
                    class="btn btn-success btn-sm"
                  >
                    <i class="bi bi-pencil"></i>
                  </a>
                  <a
                    href="javascript:void(0);"
                    data-bs-toggle="tooltip"
                    data-bs-placement="top"
                    title="Eliminar producto..."
                    onclick="confirmarEliminacion('/productos/borrar/{{producto.id}}')"
                    class="btn btn-danger btn-sm"
                  >
                    <i class="bi bi-trash"></i>
                  </a>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- ‚úÖ ESTILOS Y LIBRER√çAS -->
<link
  rel="stylesheet"
  href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css"
/>
<link
  rel="stylesheet"
  href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.bootstrap5.min.css"
/>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.bootstrap5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
<script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/pdfmake.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.7/vfs_fonts.js"></script>

<!-- ‚úÖ CONFIGURACI√ìN DE DATATABLES -->
<script>
  $(document).ready(function () {
    $("#tablaProductos").DataTable({
      dom: '<"d-flex justify-content-between mb-3"Bf>rtip', // Botones arriba
      pageLength: 5, // ‚úÖ Mostrar solo 5 productos por p√°gina
      lengthChange: false, // ‚úÖ Oculta el selector "mostrar X registros"
      paging: true, // ‚úÖ Activa paginaci√≥n
      ordering: true, // ‚úÖ Permite ordenar las columnas
      searching: true, // ‚úÖ Permite buscar
      info: true, // ‚úÖ Muestra info tipo ‚ÄúMostrando 1 a 5 de X productos‚Äù

      buttons: [
        {
          extend: "copyHtml5",
          text: '<i class="bi bi-clipboard me-1"></i> Copiar',
          className: "btn btn-outline-primary btn-sm",
          // üí° INCLUIR LAS COLUMNAS 0 A 7
          exportOptions: {
            columns: [0, 1, 2, 3, 4, 5, 6, 7],
          },
        },
        {
          extend: "excelHtml5",
          text: '<i class="bi bi-file-earmark-excel me-1"></i> Excel',
          className: "btn btn-outline-success btn-sm",
          title: "Lista_de_Productos",
          // üí° Se a√±ade exportOptions con los √≠ndices de las columnas a incluir (0-7)
          exportOptions: {
            columns: [0, 1, 2, 3, 4, 5, 6, 7],
          },
        },
        {
          extend: "pdfHtml5",
          text: '<i class="bi bi-file-earmark-pdf me-1"></i> PDF',
          className: "btn btn-outline-danger btn-sm",
          title: "Lista de Productos",
          orientation: "portrait",
          pageSize: "A4",
          exportOptions: { columns: [0, 1, 2, 3, 4, 5, 6, 7] },
        },
        {
          extend: "print",
          text: '<i class="bi bi-printer me-1"></i> Imprimir',
          className: "btn btn-imprimir btn-sm",
          title: "Lista de Productos",
          exportOptions: { columns: [0, 1, 2, 3, 4, 5, 6, 7] },
        },
      ],

      language: {
        url: "{{ url_for('static', filename='js/es-ES.json') }}",
      },
    });
  });
</script>
<style>
  /* Estilo espec√≠fico para el bot√≥n "Imprimir" */
  .btn-imprimir:hover {
    color: #212529;
    border-color: white;
    background-color: white;
    transition: all 0.3s ease;
  }

  .btn-imprimir {
    color: white;
    background-color: #6c757d;
    border-color: white;
  }
</style>
{% endblock %}
